class sort{ascSortTitle(e){return e.sort((e,t)=>{e=e.title.toUpperCase(),t=t.title.toUpperCase();return e<t?-1:t<e?1:0}),e}descSortTitle(e){return e.sort((e,t)=>{e=e.title.toUpperCase(),t=t.title.toUpperCase();return e<t?-1:t<e?1:0}),e.reverse(),e}ascSortPrice(e){return e.sort((e,t)=>(e=parseFloat(parseFloat(e.nowprice)))-(t=parseFloat(parseFloat(t.nowprice)))),e}descSortPrice(e){return e.sort((e,t)=>(e=parseFloat(parseFloat(e.nowprice)),(t=parseFloat(parseFloat(t.nowprice)))-e)),e}}async function getDatas(){let e=await fetch("./db.json");let{products:t}=await e.json();return t=t.map(e=>{var{id:t}=e.sys,{title:i,price:a}=e.content,{nowprice:n,oldprice:a}=a,{image:e}=e.images;return{id:t,title:i,oldprice:a,nowprice:n,image:e}}),t}function storageSaveProducts(e){localStorage.setItem("products",JSON.stringify(e))}function storageGetProducts(){return JSON.parse(localStorage.getItem("products"))}function storageSaveCart(e){localStorage.setItem("cart",JSON.stringify(e))}function storageGetCart(){return localStorage.getItem("cart")?JSON.parse(localStorage.getItem("cart")):[]}const renderGridView=e=>{let t=[...e],i=document.querySelector(".shop-products");i.innerHTML="";let a=document.createElement("div");a.setAttribute("class","shop-products-grid");let n=document.createElement("row");n.setAttribute("class","row");let s=t.map(e=>`
        <div class='col-lg-4 col-md-6 col-12'>
            <div class="card-product">
                <div class="card-product__img">
                    <img src="${e.image}" alt="">
                <div class="card-product__icon">
                    <div class="card-action">
                    <div class="button-add" id="add-cart" data-id="${e.id}"><span class="flaticon-shopping-cart"></span></div>
                    <div class="button-heart"><span class="flaticon-heart"></span></div>
                    </div>
                    <div class="button-view"> <span class="flaticon-search"></span></div>
                </div>
                </div>
                <div class="card-product__content"> 
                    <a class="card-product__content-title">${e.title}</a>
                    <div class="card-product__content-price">
                        <span class="now-price">$${e.nowprice}</span>
                        <span class="regular-price">${e.oldprice}</span>
                    </div>
                </div>
            </div>
        </div>
      `);e=s.join("");i.appendChild(a),a.appendChild(n),n.innerHTML=e},renderListView=e=>{let t=[...e],i=document.querySelector(".shop-products");i.innerHTML="";let a=document.createElement("div");a.setAttribute("class","shop-products-list");let n=t.map(e=>`
      <div class="card-list">
        <div class="card-list__img">
            <img src="${e.image}" alt="">
            <div class="button-view">
            <span class="flaticon-search"></span>
            </div>
        </div>
        <div class="card-list__content">
            <a class="card-list__content-title">${e.title}</a>
            <div class="card-list__content-price"> 
            <span class="now-price">$${e.nowprice}</span>
            <span class="regular-price">${e.oldprice}</span></div>
            <p class="card-list__content-dsc">Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia,</p>
            <div class="card-list__content-button"> 
            <div class="button-add" id="add-cart" data-id="${e.id}">
                <span class="flaticon-shopping-cart"></span>
            </div>
            <div class="button-heart">
                <span class="flaticon-heart"></span>
            </div>
            </div>
        </div>
    </div>`);e=n.join("");i.appendChild(a),a.innerHTML=e},getView=()=>localStorage.getItem("View")?JSON.parse(localStorage.getItem("View")):"grid",setView=e=>{localStorage.setItem("View",JSON.stringify(e))},getLimit=()=>localStorage.getItem("_limit")?JSON.parse(localStorage.getItem("_limit")):18,setLimit=e=>{localStorage.setItem("_limit",JSON.stringify(e))},getCurrentPage=()=>localStorage.getItem("CurrentPage")?JSON.parse(localStorage.getItem("CurrentPage")):1,setCurrentPage=e=>{localStorage.setItem("CurrentPage",JSON.stringify(e))},getSortStatus=()=>localStorage.getItem("SortStatus")?JSON.parse(localStorage.getItem("SortStatus")):"title-ascending",setSortStatus=e=>{localStorage.setItem("SortStatus",JSON.stringify(e))};let start=0,_limit=getLimit(),end=_limit,currentPage=getCurrentPage(),view=getView();const pagination=(e,t,i)=>{let a=[...e];start=(currentPage-1)*i,end=currentPage*i,productShowing(start,end,e);var n=a.slice(start,end);("grid"===t?renderGridView:renderListView)(n),createButtonPagination(e,t,i)},createButtonPagination=(e,t,i)=>{var a=e.length,n=Math.ceil(a/i);let s=document.querySelector(".shop-pagination"),r=document.createElement("ul"),o=document.createElement("li"),l=document.createElement("li");r.setAttribute("class","shop-pagination__list"),o.setAttribute("id","shop-pagination-next"),o.setAttribute("class","shop-pagination__list-item"),l.setAttribute("id","shop-pagination-prev"),l.setAttribute("class","shop-pagination__list-item"),l.innerText="Prev",o.innerText="Next",s.innerHTML="",s.appendChild(r),r.appendChild(l);for(let t=1;t<=n;t++){let e=document.createElement("li");e.setAttribute("class","shop-pagination__list-item"),e.setAttribute("data-number",t),e.innerText=t,t==currentPage&&(e.classList.add("shop-pagination__list-item--active"),currentPage==n?o.setAttribute("class","shop-pagination__list-item shop-pagination__list-item--active disabled"):1==currentPage&&l.setAttribute("class","shop-pagination__list-item shop-pagination__list-item--active disabled")),r.appendChild(e)}r.appendChild(o),handleClickButtonPagination(e)},handleClickButtonPagination=e=>{const i=[...e];let a=document.querySelectorAll(".shop-pagination__list-item"),n=document.querySelector("#shop-pagination-next"),s=document.querySelector("#shop-pagination-prev");for(const r of a)r.onclick=()=>{a.forEach(e=>{e.classList.remove("shop-pagination__list-item--active"),e.classList.remove("disabled")}),r.classList.add("shop-pagination__list-item--active");var e=a.length-2,t=r.dataset.number;t==e?n.className="shop-pagination__list-item shop-pagination__list-item--active disabled":1==t&&(s.className="shop-pagination__list-item shop-pagination__list-item--active disabled"),currentPage=t,console.log(currentPage),setCurrentPage(currentPage),pagination(i,view,_limit)};n.onclick=()=>{!0!==n.className.includes("active")&&(currentPage++,console.log(currentPage),setCurrentPage(currentPage),pagination(i,view,_limit))},s.onclick=()=>{if(!0!==s.className.includes("active")){currentPage--,console.log(currentPage),setCurrentPage(currentPage),pagination(i,view,_limit);var e=Math.ceil(i.length/_limit);if(currentPage>e){let e=document.querySelector("#shop-pagination-next");e.className="shop-pagination__list-item shop-pagination__list-item--active disabled"}}}},handleClickButtonView=t=>{const i=document.querySelectorAll(".shop-topbar__view-button");for(const a of i)a.onclick=()=>{if(!0!==a.className.includes("active")){if(i.forEach(e=>{e.classList.remove("shop-topbar__view-button--active")}),a.classList.add("shop-topbar__view-button--active"),view=a.dataset.view,setView(view),"grid"===view){_limit=18,setLimit(_limit),pagination(t,view,_limit);var e=parseInt(getCurrentPage());if(Math.ceil(t.length/_limit)<e){let e=document.querySelector("#shop-pagination-next");e.className="shop-pagination__list-item shop-pagination__list-item--active disabled"}}"list"===view&&(_limit=8,setLimit(_limit),pagination(t,view,_limit))}}},defaultButtonViewActive=e=>{const t=e,i=[...document.querySelectorAll(".shop-topbar__view-button")],a=i.filter(e=>e.dataset.view===t);a[0].classList.add("shop-topbar__view-button--active")},productShowing=(e,t,i)=>{let a=document.querySelector(".show-products");i=i.length;i<t&&(t=i),a.innerText=`Showing ${e+1} - ${t-1} of ${i-1} result`},runSorting=(e,t)=>{let i=[],a=new sort;"title-ascending"===t?i=[...a.ascSortTitle(e)]:"title-descending"===t?i=[...a.descSortTitle(e)]:"price-ascending"===t?i=[...a.ascSortPrice(e)]:"price-descending"===t&&(i=[...a.descSortPrice(e)]),pagination(i,view,_limit)},sortProducts=t=>{let e=document.querySelector("#sort");e.onchange=e=>{e=e.target.value;runSorting(t,e),setSortStatus(e)}},defaultSort=e=>{var t=[...e];let i=[...document.querySelectorAll("#sort option")],a=getSortStatus(),n=i.filter(e=>e.value==a);n[0].setAttribute("selected","selected");var s=n[0].value;runSorting(t,s),sortProducts(e)};sortProducts();const defaultLoadingPage=()=>{getDatas().then(e=>{storageSaveProducts(e);var t=getView(),i=getLimit();defaultSort(e),defaultButtonViewActive(t),pagination(e,t,i),handleClickButtonView(e),addMiniCart()})};defaultLoadingPage();const addMiniCart=()=>{let i=[];for(const a of[...document.querySelectorAll("#add-cart")])a.onclick=()=>{var e=a.dataset.id,t=storageGetCart(),e={...findProduct(e),amount:1};i=[...t,e];for(let t=0;t<i.length;t++)for(let e=t+1;e<i.length;e++)i[t].id===i[e].id&&(i.splice(e,1),i[t].amount+=1);e=[...i];storageSaveCart(e),renderMiniCart(e),setMiniCartValue(e)}},removeMiniCart=i=>{for(const a of[...document.querySelectorAll(".remove-product")])a.onclick=()=>{let t=a.dataset.id;var e=i.filter(e=>e.id!==t);renderMiniCart(e),setMiniCartValue(e),storageSaveCart(e)}},findProduct=t=>{let e=[...storageGetProducts()];return e.find(e=>e.id===t)},renderMiniCart=e=>{let t=document.querySelector(".cart__dropdown");if(t.innerHTML="",0===e.length){let e=document.createElement("h4");e.setAttribute("class","cart__dropdown-message");return e.innerText="Your cart is currently empty",void t.appendChild(e)}let i=e.map(e=>`
    <div class="cart__dropdown-inner">
        <div class="single-product__img"><img src="${e.image}" alt=""></div>
        <div class="single-product__text">
            <a class="single-product__text-name" href="#">${e.title}</a>
            <span class="single-product__text-quantiny">${e.amount}</span>
            <h4 class="single-product__text-price">$${e.nowprice}</h4>
        </div><span class="fas fa-trash-alt remove-product" data-id="${e.id}"></span>
    </div>`);var a=i.join("").concat(`
  <div class="cart__dropdown-total"> 
    <span>Total</span>
    <span class="cart-total">$0.00</span>
  </div>
  <div class="cart__dropdown-btn"> 
        <a class="view-cart" href="cart.html">view cart</a>
        <a class="check-cart" href="#">check cart</a>
  </div>
`);t.innerHTML=a,setMiniCartValue(e),removeMiniCart(e)},setMiniCartValue=e=>{let t=[...e],i=document.querySelector(".cart-count"),a=document.querySelectorAll(".cart-total"),n=0,s=0;if(0===e.length)return i.innerHTML=n,void a.forEach(e=>{e.innerHTML=`$${s.toFixed(2)}`});t.forEach(e=>{n+=+e.amount,s+=e.amount*e.nowprice}),i.innerHTML=n,a.forEach(e=>{e.innerHTML=`$${s.toFixed(2)}`})},defaultLoadingMiniCart=()=>{var e=storageGetCart();renderMiniCart(e),e.length};defaultLoadingMiniCart();const main={init:function(){this.navMenu(),this.bannerSlide(),this.carousel(),this.load()},navMenu:function(){const e=document.querySelector(".head-mobile"),t=document.querySelector(".head-nav"),i=document.querySelector(".head"),a=document.querySelectorAll(".nav-plus");let n=i.offsetHeight,s=!0;function r(){window.pageYOffset>n?i.classList.add("head--active"):i.classList.remove("head--active")}e.addEventListener("click",function(){t.classList.toggle("head-nav--active")}),window.addEventListener("scroll",r),a.forEach(a=>{a.addEventListener("click",e=>{e.preventDefault(),s=!s;let t=a.childNodes[0],i=a.parentElement.nextElementSibling;i.classList.toggle("sub-menu--active"),s?t.className="fas fa-plus":t.className="fas fa-minus"})}),r()},bannerSlide:function(){if(document.querySelector(".banner")){const n=[...document.querySelectorAll(".banner-slides__item")],s=[...document.querySelectorAll(".banner-slides__dot")];!function(){let a=setInterval(()=>{let e=0,t=document.querySelector(".banner-slides__item--active");for(e;t=t.previousElementSibling;e++);i(e)},3e3);function i(e){if(e<n.length-1){for(let e=0;e<n.length;e++)n[e].classList.remove("banner-slides__item--active"),s[e].classList.remove("banner-slides__dot--active");n[e].nextElementSibling.classList.add("banner-slides__item--active"),s[e].nextElementSibling.classList.add("banner-slides__dot--active")}else{for(let e=0;e<n.length;e++)n[e].classList.remove("banner-slides__item--active"),s[e].classList.remove("banner-slides__dot--active");n[0].classList.add("banner-slides__item--active"),s[0].classList.add("banner-slides__dot--active")}}s.forEach(i=>{i.addEventListener("click",()=>{clearInterval(a);let e=0;s.forEach(e=>{e.classList.remove("banner-slides__dot--active")}),i.classList.add("banner-slides__dot--active");let t=document.querySelector(".banner-slides__dot--active");for(e;t=t.previousElementSibling;e++);n.forEach(e=>{e.classList.remove("banner-slides__item--active")}),n[e].classList.add("banner-slides__item--active")})});let e=document.querySelector(".banner-slides__prev"),t=document.querySelector(".banner-slides__next");e.addEventListener("click",function(){let e=0,t=document.querySelector(".banner-slides__item--active");for(clearInterval(a),e;t=t.previousElementSibling;e++);i(e)}),t.addEventListener("click",function(){let e=0,t=document.querySelector(".banner-slides__item--active");for(clearInterval(a),e;t=t.previousElementSibling;e++);i(e)})}()}},carousel:function(){var e=document.querySelector(".home-detail"),t=document.querySelector(".brand"),i=document.querySelector(".blog");e?$(".home-detail__slide").owlCarousel({loop:!0,margin:20,dots:!1,nav:!0,responsive:{0:{items:1},600:{items:1},1e3:{items:1}}}):console.log("Not Section"),t?$(".brand-slide").owlCarousel({loop:!1,margin:20,dots:!1,nav:!1,responsive:{0:{items:2},600:{items:3},767:{items:4},1e3:{items:5}}}):console.log("Not Section"),i?$(".blog-slide").owlCarousel({loop:!1,margin:20,dots:!1,nav:!0,responsive:{0:{items:1},600:{items:1},767:{items:2},1e3:{items:2}}}):console.log("Not Section")},load:function(){let e=document.querySelector(".loading");window.addEventListener("load",()=>{setTimeout(()=>{e.classList.add("loading--off")},1500)})}};main.init();